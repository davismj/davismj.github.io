<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    <title>Aurelia Authentication&#58; Multiple shells. â€“ Matthew James Davis</title>

    <meta name="author" content="Matthew James Davis" />
    <meta name="description" content="Creating a separate login-specific Aurelia root within your Aurelia app." />
    <meta name="keywords" content="aurelia,login,best-practices" />

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href='https://fonts.googleapis.com/css?family=Raleway:500,600' rel='stylesheet' type='text/css'>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="stylesheet" type="text/css" href="/desktop.css" media="screen and (min-width: 641px) and (min-height: 641px)" />
    <link rel="stylesheet" type="text/css" href="/mobile.css" media="screen and (max-width: 640px), screen and (max-height: 640px)" />
    <link rel="alternate" type="application/rss+xml" title="Matthew James Davis" href="/feed.xml" />
  </head>

  <body>
    <nav>
      <div>
        <a href="/"><img class="avatar" src="/images/me.jpg" />
        <h1 class="text-center">Matthew James Davis</h1></a>
        <p class="hide-mobile">Aurelia core team member Matthew James Davis is out to educate the community.</p>
        <ul>
          <a href="/blog/"><li class="active">Blog</li></a>
          <a href="/portfolio/"><li class="">Portfolio</li></a>
          <a href="/contact/"><li class="">Contact Me</li></a>
        </ul>
      </div>
    </nav>
    
    <main>
      <article>
	<header>
		Aurelia Authentication&#58; Multiple shells.
		<time>15 Aug 2015</time>
	</header>
	<p>Almost everyone building an Aurelia application wants to include some form of authentication. Aurelia includes a number of powerful features for handling authentication securely and effectively. We&#39;re going to look at the concept of including multiple shells, or root view models, within an Aurelia app to keep your app logic separate from your login logic.</p>

<h1>What is a Shell?</h1>

<p>The shell, sometimes called the root, is the root view model of your page. The Aurelia bootstrapper is designed to automatically get your app initialized using <code>src/app.js</code> as the root. However, if you&#39;d like to customize your app initialization, you can pass a javascript file to your body tag, for example <code>aurelia-app=&quot;main&quot;</code>, to instruct Aurelia to load in a custom intialization file.</p>

<h4>src/main.js</h4>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">configure</span><span class="p">(</span><span class="nx">aurelia</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">aurelia</span><span class="p">.</span><span class="nx">use</span>
    <span class="p">.</span><span class="nx">standardConfiguration</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">developmentLogging</span><span class="p">();</span>

  <span class="c1">// This line tells Aurelia to start up and then set the root view model for</span>
  <span class="c1">// our application. If no name is given, it defaults to loading &#39;app.js&#39;.</span>
  <span class="nx">aurelia</span><span class="p">.</span><span class="nx">start</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">app</span> <span class="o">=&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">setRoot</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<h1>The Login Shell</h1>

<p>Instead of sending the user directly into our application, we&#39;re going to request them to login first by sending them to a login shell instead. Once our user logs in, then they will be redirected to the main application. First, lets modify our initialization file to load in to direct to the login shell.</p>

<h4>src/main.js</h4>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">configure</span><span class="p">(</span><span class="nx">aurelia</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">aurelia</span><span class="p">.</span><span class="nx">use</span>
    <span class="p">.</span><span class="nx">standardConfiguration</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">developmentLogging</span><span class="p">();</span>

  <span class="nx">aurelia</span><span class="p">.</span><span class="nx">start</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">app</span> <span class="o">=&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">setRoot</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>Next, let&#39;s create a login shell. Your shell will probably be more interesting than mine, but I&#39;m going to keep my shell to a minimum. It will only have login prompt and a function that will login and redirect to the app.</p>

<h4>src/login.js</h4>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">inject</span><span class="p">,</span> <span class="nx">Aurelia</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;aurelia-framework&#39;</span><span class="p">;</span>

<span class="c1">// First, we must inject the Aurelia object. This is the same Aurelia object</span>
<span class="c1">// passed into our configure function on main.js.</span>
<span class="err">@</span><span class="nx">inject</span><span class="p">(</span><span class="nx">Aurelia</span><span class="p">)</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">Login</span> <span class="p">{</span>

  <span class="nx">username</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">error</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="nx">aurelia</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Once we have access to the Aurelia object, we can use it from</span>
    <span class="c1">// within our login function to set the new root view model to </span>
    <span class="c1">// our main App on succesful login.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">aurelia</span><span class="p">.</span><span class="nx">setRoot</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="s1">&#39;Please enter a username and password.&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>And, of course, view model will be bound to <code>login.html</code>. Since this view is actually the root view, we do not need to try to use any special tricks to customize our view around any other views; we are free to include anything we want into this view and it will always remain completely separate from our main app.</p>

<h1>Notes</h1>

<p>Notice that we don&#39;t define a router in our login. In fact, there is no router in our app at all. That means that instead of merely blocking a user from accessing a route, the route doesn&#39;t exist, which means more security. Additionally, this means you can send a user to a route that doesn&#39;t exist on the login shell and redirect them to that specific route after login.</p>

<h1>Links</h1>

<p><a href="http://davismj.github.io/skeleton-navigation-login-shell">Working Demo</a><br />
<a href="https://github.com/davismj/skeleton-navigation-login-shell">Full source on GitHub</a><br />
<a href="http://aurelia.io/docs.html#startup-and-configuration">Intialization Docs</a><br />
<a href="http://aurelia.io/docs.html#the-aurelia-object">Aurelia Object Docs</a></p>

</article>
<!-- 
<footer>
	
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
    
	    var disqus_shortname = 'foursails'; 

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</footer> -->
    </main>
    
    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-58706961-2', 'auto');
		ga('send', 'pageview');
	</script>
	<!-- End Google Analytics -->

  </body>
</html>
